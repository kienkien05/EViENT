import{u as M,a as q,b,j as e}from"./query-By2FkZ5k.js";import{r as l}from"./vendor-Bxm2pvdK.js";import{B as r,g as v,h as c,b as o,j as F}from"./index-D8pja-1O.js";import{M as L}from"./Modal-DuN345BA.js";import{O as P,R as Q,V as T,Y as N,_ as U}from"./ui-BgMx_JBB.js";function R(){const[y,i]=l.useState(!1),[d,u]=l.useState(null),[n,t]=l.useState({title:"",image_url:"",link_url:"",priority:0,is_active:!0}),[m,x]=l.useState(!1),g=M(),{data:k,isLoading:_}=q({queryKey:["admin","banners"],queryFn:()=>o.getBanners().then(s=>s.data.data)}),w=b({mutationFn:s=>o.deleteBanner(s),onSuccess:()=>{g.invalidateQueries({queryKey:["admin","banners"]}),c.success("Đã xóa banner")}}),h=b({mutationFn:s=>d?o.updateBanner(d.id,s):o.createBanner(s),onSuccess:()=>{g.invalidateQueries({queryKey:["admin","banners"]}),i(!1),c.success("Đã lưu")}}),C=()=>{u(null),t({title:"",image_url:"",link_url:"",priority:0,is_active:!0}),i(!0)},S=s=>{u(s),t({title:s.title,image_url:s.image_url,link_url:s.link_url||"",priority:s.priority||0,is_active:s.is_active}),i(!0)},p=async s=>{var f;const a=(f=s.target.files)==null?void 0:f[0];if(a){x(!0);try{const j=await F.upload(a);t(z=>({...z,image_url:j.data.data.url})),c.success("Tải ảnh lên thành công")}catch{c.error("Lỗi khi tải ảnh lên")}finally{x(!1)}}},B=k||[];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Quản lý banner"}),e.jsxs(r,{onClick:C,className:"gap-2",children:[e.jsx(P,{className:"size-4"})," Thêm banner"]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:_?Array.from({length:3}).map((s,a)=>e.jsx("div",{className:"skeleton aspect-[2/1] rounded-xl"},a)):B.map(s=>e.jsxs("div",{className:"bg-card border border-border rounded-xl overflow-hidden",children:[e.jsx("img",{src:v(s.image_url,{width:600}),alt:s.title,className:"w-full aspect-[2/1] object-cover",crossOrigin:"anonymous"}),e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-sm truncate",children:s.title}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${s.is_active?"bg-green-500/10 text-green-600":"bg-gray-500/10 text-gray-500"}`,children:s.is_active?"Active":"Hidden"})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>S(s),className:"flex-1 gap-1",children:[e.jsx(Q,{className:"size-3"})," Sửa"]}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>w.mutate(s.id),children:e.jsx(T,{className:"size-3 text-destructive"})})]})]})]},s.id))}),e.jsxs(L,{isOpen:y,onClose:()=>i(!1),title:d?"Sửa banner":"Thêm banner",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tiêu đề *"}),e.jsx("input",{value:n.title,onChange:s=>t(a=>({...a,title:s.target.value})),className:"w-full h-10 px-3 rounded-lg border border-input bg-background outline-none focus:ring-2 focus:ring-ring text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ảnh Banner *"}),n.image_url?e.jsxs("div",{className:"relative group rounded-lg overflow-hidden border border-border",children:[e.jsx("img",{src:v(n.image_url),className:"w-full aspect-[2/1] object-cover",alt:"Banner Preview",crossOrigin:"anonymous"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:e.jsxs("label",{className:"cursor-pointer text-white flex items-center gap-1 text-sm hover:underline",children:[e.jsx(N,{className:"size-4"})," Đổi ảnh",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:p})]})})]}):e.jsxs("label",{className:"flex flex-col items-center justify-center w-full aspect-[2/1] border-2 border-dashed border-border rounded-lg cursor-pointer hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[m?e.jsx(U,{className:"size-6 text-muted-foreground animate-spin mb-2"}):e.jsx(N,{className:"size-6 text-muted-foreground mb-2"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Nhấn để tải ảnh lên"})]}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",disabled:m,onChange:p})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"URL liên kết"}),e.jsx("input",{value:n.link_url,onChange:s=>t(a=>({...a,link_url:s.target.value})),className:"w-full h-10 px-3 rounded-lg border border-input bg-background outline-none focus:ring-2 focus:ring-ring text-sm"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ưu tiên"}),e.jsx("input",{type:"number",value:n.priority,onChange:s=>t(a=>({...a,priority:Number(s.target.value)})),className:"w-full h-10 px-3 rounded-lg border border-input bg-background outline-none focus:ring-2 focus:ring-ring text-sm"})]}),e.jsx("div",{className:"flex items-end pb-1",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.is_active,onChange:s=>t(a=>({...a,is_active:s.target.checked})),className:"size-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Hiển thị"})]})})]})]}),e.jsxs("div",{className:"mt-4 flex gap-3",children:[e.jsx(r,{onClick:()=>h.mutate(n),loading:h.isPending,className:"flex-1",children:"Lưu"}),e.jsx(r,{variant:"outline",onClick:()=>i(!1),className:"flex-1",children:"Hủy"})]})]})]})}export{R as default};
