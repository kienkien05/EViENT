import{u as B,a as S,b as K,j as e}from"./query-By2FkZ5k.js";import{r as a}from"./vendor-Bxm2pvdK.js";import{k as _,B as o,h as f,e as b}from"./index-CUfHF9RD.js";import{S as c}from"./Skeleton-l4uPorLi.js";import{M as Q}from"./Modal-BdgH8NYW.js";import{S as G,T as q,O as T,R as D,V as H,a1 as O}from"./ui-BgMx_JBB.js";const E={name:"",description:"",price:0,original_price:0,quantity_total:100};function X(){const[v,z]=a.useState(""),[n,j]=a.useState(""),[V,d]=a.useState(!1),[u,N]=a.useState(null),[i,l]=a.useState({...E}),y=B(),{data:g,isLoading:L}=S({queryKey:["admin","events","all",{status:""}],queryFn:()=>b.getEvents({limit:100,status:""}).then(s=>s.data)}),{data:p,isLoading:M}=S({queryKey:["admin","event",n],queryFn:()=>b.getEventById(n).then(s=>s.data),enabled:!!n}),x=(g==null?void 0:g.data)||[],k=x.filter(s=>s.title.toLowerCase().includes(v.toLowerCase())),r=p==null?void 0:p.data,m=(r==null?void 0:r.ticket_types)||[],h=K({mutationFn:s=>b.updateEvent(n,{ticket_types:s}),onSuccess:()=>{y.invalidateQueries({queryKey:["admin","event",n]}),y.invalidateQueries({queryKey:["admin","events","all"]}),d(!1),f.success("Đã lưu thay đổi loại vé thành công")},onError:s=>{var t,C;f.error(((C=(t=s.response)==null?void 0:t.data)==null?void 0:C.message)||"Có lỗi khi lưu thay đổi. Thử lại sau.")}});a.useEffect(()=>{x.length>0&&!n&&j(x[0].id)},[x,n]);const w=()=>{N(null),l({...E}),d(!0)},F=(s,t)=>{N(t),l({id:s.id,name:s.name||"",description:s.description||"",price:s.price||0,original_price:s.original_price||0,quantity_total:s.quantity_total||0}),d(!0)},I=s=>{if(window.confirm("Bạn có chắc chắn muốn xóa loại vé này? Những vé đã bán vẫn sẽ tồn tại nhưng không thể mua mới.")){const t=[...m];t.splice(s,1),h.mutate(t)}},P=()=>{if(!i.name.trim()){f.error("Vui lòng nhập tên vé");return}const s=[...m];u!==null?s[u]={...s[u],...i}:s.push(i),h.mutate(s)};return e.jsxs("div",{className:"flex flex-col md:flex-row h-[calc(100vh-8rem)] gap-6",children:[e.jsxs("div",{className:"w-full md:w-80 flex flex-col bg-card border border-border rounded-xl overflow-hidden shrink-0",children:[e.jsxs("div",{className:"p-4 border-b border-border",children:[e.jsx("h2",{className:"font-semibold text-lg mb-4",children:"Chọn sự kiện"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 size-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Tìm sự kiện...",value:v,onChange:s=>z(s.target.value),className:"w-full h-9 pl-9 pr-3 text-sm rounded-lg border border-input bg-background outline-none focus:ring-2 focus:ring-ring"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-1",children:L?e.jsxs("div",{className:"p-4 opacity-50 space-y-3",children:[e.jsx(c,{className:"h-10 w-full"}),e.jsx(c,{className:"h-10 w-full"}),e.jsx(c,{className:"h-10 w-full"})]}):k.length===0?e.jsx("div",{className:"text-center p-4 text-sm text-muted-foreground",children:"Không tìm thấy sự kiện nào"}):k.map(s=>{var t;return e.jsxs("button",{onClick:()=>j(s.id),className:_("w-full text-left px-3 py-2.5 rounded-lg text-sm font-medium transition-colors flex items-center justify-between group",n===s.id?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-muted hover:text-foreground"),children:[e.jsx("span",{className:"truncate pr-2",children:s.title}),((t=s.ticket_types)==null?void 0:t.length)>0&&e.jsx("span",{className:_("text-[10px] px-1.5 py-0.5 rounded-full shrink-0",n===s.id?"bg-primary/20":"bg-muted-foreground/20 group-hover:bg-muted-foreground/30"),children:s.ticket_types.length})]},s.id)})})]}),e.jsx("div",{className:"flex-1 flex flex-col bg-card border border-border rounded-xl overflow-hidden min-h-[400px]",children:n?M?e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx(c,{className:"h-8 w-1/3 mb-6"}),e.jsx(c,{className:"h-24 w-full"}),e.jsx(c,{className:"h-24 w-full"})]}):r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 border-b border-border flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold truncate max-w-lg",title:r.title,children:["Các loại vé: ",r.title]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Tổng cộng ",m.length," loại vé"]})]}),e.jsxs(o,{onClick:w,className:"gap-2 shrink-0",children:[e.jsx(T,{className:"size-4"})," Thêm loại vé"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-muted/30",children:m.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center py-12 text-muted-foreground",children:[e.jsx(q,{className:"size-12 mb-4 opacity-20"}),e.jsx("p",{className:"font-medium",children:"Sự kiện này chưa có loại vé nào"}),e.jsxs(o,{variant:"outline",onClick:w,className:"mt-4 gap-2",children:[e.jsx(T,{className:"size-4"})," Tạo loại vé đầu tiên"]})]}):e.jsx("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4",children:m.map((s,t)=>e.jsxs("div",{className:"bg-background border border-border rounded-xl p-5 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("h3",{className:"font-semibold text-lg truncate flex items-center gap-2",children:[s.name,s.quantity_sold>=s.quantity_total&&e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider bg-destructive/10 text-destructive px-2 py-0.5 rounded",children:"Hết vé"})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:s.description})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>F(s,t),className:"h-8 w-8 text-muted-foreground hover:text-foreground",children:e.jsx(D,{className:"size-3.5"})}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>I(t),loading:h.isPending,className:"h-8 w-8 text-muted-foreground hover:text-destructive",children:e.jsx(H,{className:"size-3.5"})})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-border grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Giá bán"}),e.jsxs("p",{className:"font-bold text-primary",children:[Number(s.price).toLocaleString("vi-VN")," đ"]}),s.original_price>s.price&&e.jsxs("p",{className:"text-xs text-muted-foreground line-through mt-0.5",children:[Number(s.original_price).toLocaleString("vi-VN")," đ"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Số lượng"}),e.jsxs("div",{className:"flex items-end gap-1.5",children:[e.jsx("p",{className:"font-semibold",children:s.quantity_sold||0}),e.jsxs("p",{className:"text-xs text-muted-foreground font-normal pb-[2px]",children:["/ ",s.quantity_total]})]}),e.jsx("div",{className:"w-full h-1.5 bg-muted rounded-full mt-1 overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full transition-all",style:{width:`${Math.min(100,(s.quantity_sold||0)/s.quantity_total*100)}%`}})})]})]})]},s.id||t))})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-muted-foreground",children:"Lỗi khi tải thông tin sự kiện"}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-muted-foreground p-8 text-center",children:[e.jsx(q,{className:"size-12 mb-4 opacity-20"}),e.jsx("h3",{className:"text-lg font-medium",children:"Quản lý các loại vé"}),e.jsx("p",{className:"text-sm mt-1 max-w-sm",children:"Chọn một sự kiện từ danh sách bên trái để xem và quản lý các loại vé của sự kiện đó."})]})}),e.jsx(Q,{isOpen:V,onClose:()=>d(!1),title:u!==null?"Sửa loại vé":"Thêm loại vé mới",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Tên loại vé ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx("input",{value:i.name,onChange:s=>l(t=>({...t,name:s.target.value})),placeholder:"VD: Vé VIP, Vé thường...",className:"w-full h-10 px-3 rounded-lg border border-input bg-background outline-none focus:ring-2 focus:ring-ring text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Giá bán (VNĐ) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx("input",{type:"number",min:0,value:i.price,onChange:s=>l(t=>({...t,price:Number(s.target.value)})),className:"w-full h-10 px-3 rounded-lg border border-input bg-background outline-none focus:ring-2 focus:ring-ring text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Giá gốc (VNĐ)"}),e.jsx("input",{type:"number",min:0,value:i.original_price,onChange:s=>l(t=>({...t,original_price:Number(s.target.value)})),className:"w-full h-10 px-3 rounded-lg border border-input bg-background outline-none focus:ring-2 focus:ring-ring text-sm"}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:"(Tùy chọn) Giá trước khi giảm"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Tổng số lượng vé phát hành ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx("input",{type:"number",min:1,value:i.quantity_total,onChange:s=>l(t=>({...t,quantity_total:Number(s.target.value)})),className:"w-full h-10 px-3 rounded-lg border border-input bg-background outline-none focus:ring-2 focus:ring-ring text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Mô tả chi tiết"}),e.jsx("textarea",{value:i.description,onChange:s=>l(t=>({...t,description:s.target.value})),rows:3,placeholder:"VD: Bao gồm 1 thức uống, vị trí ngồi gần sân khấu...",className:"w-full p-3 rounded-lg border border-input bg-background outline-none focus:ring-2 focus:ring-ring text-sm resize-none custom-scrollbar"})]}),e.jsxs("div",{className:"pt-4 flex gap-3 border-t border-border",children:[e.jsxs(o,{onClick:P,loading:h.isPending,className:"flex-1 gap-2",children:[e.jsx(O,{className:"size-4"})," Lưu loại vé"]}),e.jsx(o,{variant:"outline",onClick:()=>d(!1),className:"flex-1",children:"Hủy"})]})]})})]})}export{X as default};
