import{a as v,b as N,j as e}from"./query-By2FkZ5k.js";import{r as f,u as _}from"./vendor-Bxm2pvdK.js";import{u as k,g as C,B as o,i as l,h as r,j as w}from"./index-CUfHF9RD.js";import{m as P,t as S,U as F,u as z,q as E,a as U}from"./ui-BgMx_JBB.js";function B(){const{user:a,updateUser:c}=k(),[m,d]=f.useState(!1),[h,g]=f.useState({full_name:(a==null?void 0:a.full_name)||"",phone_number:(a==null?void 0:a.phone_number)||"",address:(a==null?void 0:a.address)||"",gender:(a==null?void 0:a.gender)||"",date_of_birth:(a==null?void 0:a.date_of_birth)||"",facebook_url:(a==null?void 0:a.facebook_url)||""}),{data:q,isLoading:K}=v({queryKey:["profile"],queryFn:()=>l.getProfile().then(t=>t.data.data)}),u=N({mutationFn:t=>l.updateProfile(t),onSuccess:t=>{c(t.data.data),d(!1),r.success("Cập nhật thành công!")},onError:t=>{var s,n;r.error(((n=(s=t.response)==null?void 0:s.data)==null?void 0:n.message)||"Cập nhật thất bại")}}),x=_(),p=async()=>{if(a!=null&&a.email)try{await l.forgotPassword(a.email),r.info("Mã OTP đã được gửi vào email để đổi mật khẩu"),x("/verify-otp",{state:{email:a.email,type:"change-password"}})}catch{r.error("Không thể gửi mã OTP")}},b=async t=>{var n;const s=(n=t.target.files)==null?void 0:n[0];if(s)try{const{data:i}=await w.upload(s,"avatars");await l.updateProfile({avatar_url:i.data.url}),c({avatar_url:i.data.url}),r.success("Đã cập nhật ảnh đại diện")}catch{r.error("Không thể tải ảnh lên")}};return e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Tài khoản"}),e.jsxs(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-card border border-border rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-6 text-center border-b border-border bg-gradient-to-br from-primary/5 to-orange-500/5",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:C(a==null?void 0:a.avatar_url,{width:200}),alt:a==null?void 0:a.full_name,className:"size-24 rounded-full object-cover border-4 border-background shadow-md",crossOrigin:"anonymous"}),e.jsxs("label",{className:"absolute bottom-0 right-0 size-8 bg-primary rounded-full flex items-center justify-center cursor-pointer hover:bg-primary/80 transition-colors shadow-md",children:[e.jsx(S,{className:"size-4 text-primary-foreground"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:b})]})]}),e.jsx("h2",{className:"mt-3 text-lg font-semibold",children:a==null?void 0:a.full_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a==null?void 0:a.email})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[[{key:"full_name",label:"Họ và tên",icon:F},{key:"phone_number",label:"Số điện thoại",icon:z},{key:"address",label:"Địa chỉ",icon:E},{key:"date_of_birth",label:"Ngày sinh",icon:U,type:"date"}].map(({key:t,label:s,icon:n,type:i})=>e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-1.5 text-muted-foreground",children:[e.jsx(n,{className:"size-4"})," ",s]}),m?e.jsx("input",{type:i||"text",value:h[t]||"",onChange:j=>g(y=>({...y,[t]:j.target.value})),className:"w-full h-10 px-3 rounded-lg border border-input bg-background focus:ring-2 focus:ring-ring outline-none transition-all text-sm"}):e.jsx("p",{className:"text-sm py-2",children:(a==null?void 0:a[t])||"—"})]},t)),e.jsx("div",{className:"flex gap-3 pt-2",children:m?e.jsxs(e.Fragment,{children:[e.jsx(o,{onClick:()=>u.mutate(h),loading:u.isPending,className:"flex-1",children:"Lưu"}),e.jsx(o,{variant:"outline",onClick:()=>d(!1),className:"flex-1",children:"Hủy"})]}):e.jsxs(e.Fragment,{children:[e.jsx(o,{onClick:()=>d(!0),variant:"outline",className:"flex-1",children:"Chỉnh sửa hồ sơ"}),e.jsx(o,{onClick:p,variant:"default",className:"flex-1",children:"Đổi mật khẩu"})]})})]})]})]})}export{B as default};
