import{u as R,a as V,b as U,j as e}from"./query-By2FkZ5k.js";import{r as l}from"./vendor-Bxm2pvdK.js";import{B as r,f as o,k as O,h as m,m as g}from"./index-CLvu16Z-.js";import{M as K}from"./Modal-DkDMuUGE.js";import{S as $}from"./Select-B-0jrKDi.js";import{T as B}from"./Skeleton-DZhbFETI.js";import{O as L,S as G,J as k,$ as M,a0 as E,v as P,U as A,K as w,G as I,o as X,a as J,y as W}from"./ui-BgMx_JBB.js";const _={email:"",full_name:"",password:"",role:"user"},Y={register:"Đăng ký tài khoản",reset:"Đặt lại mật khẩu",admin_update:"Admin cập nhật",self_update:"Tự đổi mật khẩu"};function le(){const[d,f]=l.useState(""),[c,x]=l.useState(1),[D,u]=l.useState(!1),[Q,j]=l.useState(!1),[b,q]=l.useState(!1),[t,N]=l.useState(null),[n,i]=l.useState({..._}),C=R(),{data:v,isLoading:F}=V({queryKey:["admin","users",{search:d,page:c}],queryFn:()=>g.getUsers({search:d,page:c,limit:20}).then(s=>s.data)}),y=U({mutationFn:s=>g.toggleStatus(s),onSuccess:()=>{C.invalidateQueries({queryKey:["admin","users"]}),m.success("Đã cập nhật trạng thái")}}),z=U({mutationFn:s=>g.createUser(s),onSuccess:()=>{C.invalidateQueries({queryKey:["admin","users"]}),u(!1),i({..._}),m.success("Đã tạo người dùng")},onError:s=>{var a,T;m.error(((T=(a=s.response)==null?void 0:a.data)==null?void 0:T.message)||"Không thể tạo người dùng")}}),H=()=>{if(!n.email.trim()||!n.full_name.trim()||!n.password.trim()){m.error("Vui lòng nhập đầy đủ thông tin");return}if(n.password.length<6){m.error("Mật khẩu phải có ít nhất 6 ký tự");return}z.mutate(n)},h=s=>{g.getUserById(s.id).then(a=>{N(a.data.data),j(!0)}).catch(()=>{N(s),j(!0)})},S=(v==null?void 0:v.data)||[];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3 mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Quản lý người dùng"}),e.jsxs(r,{onClick:()=>{i({..._}),u(!0)},className:"gap-2",children:[e.jsx(L,{className:"size-4"})," Tạo người dùng"]})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 size-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Tìm kiếm người dùng...",value:d,onChange:s=>{f(s.target.value),x(1)},className:"w-full h-10 pl-10 pr-4 rounded-lg border border-input bg-background outline-none focus:ring-2 focus:ring-ring text-sm"})]}),e.jsx("div",{className:"hidden md:block bg-card border border-border rounded-xl overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border bg-muted/50",children:[e.jsx("th",{className:"text-left p-3 font-medium",children:"Họ tên"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Email"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Vai trò"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Trạng thái"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Ngày tạo"}),e.jsx("th",{className:"text-right p-3 font-medium",children:"Thao tác"})]})}),e.jsx("tbody",{children:F?Array.from({length:5}).map((s,a)=>e.jsx(B,{columns:6},a)):S.map(s=>e.jsxs("tr",{className:"border-b border-border last:border-0 hover:bg-muted/30 cursor-pointer",onClick:()=>h(s),children:[e.jsx("td",{className:"p-3 font-medium",children:s.full_name}),e.jsx("td",{className:"p-3 text-muted-foreground",children:s.email}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full ${s.role==="admin"?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"}`,children:s.role==="admin"?"Admin":"User"})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full border ${s.is_active?"bg-green-500/10 text-green-600 border-green-500/20":"bg-red-500/10 text-red-500 border-red-500/20"}`,children:s.is_active?"Hoạt động":"Đã khóa"})}),e.jsx("td",{className:"p-3 text-muted-foreground",children:s.created_at?o(s.created_at):"—"}),e.jsx("td",{className:"p-3 text-right",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>h(s),title:"Xem chi tiết",children:e.jsx(k,{className:"size-4"})}),e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>y.mutate(s.id),title:s.is_active?"Khóa tài khoản":"Kích hoạt",children:s.is_active?e.jsx(M,{className:"size-4 text-destructive"}):e.jsx(E,{className:"size-4 text-green-600"})})]})})]},s.id))})]})}),e.jsx("div",{className:"md:hidden space-y-3",children:S.map(s=>e.jsx("div",{className:"bg-card border border-border rounded-xl p-4",onClick:()=>h(s),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-sm",children:s.full_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.email})]}),e.jsxs("div",{className:"flex gap-1",onClick:a=>a.stopPropagation(),children:[e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>h(s),children:e.jsx(k,{className:"size-4"})}),e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>y.mutate(s.id),children:s.is_active?e.jsx(M,{className:"size-4 text-destructive"}):e.jsx(E,{className:"size-4 text-green-600"})})]})]})},s.id))}),e.jsxs(K,{isOpen:D,onClose:()=>u(!1),title:"Tạo người dùng mới",size:"md",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Email *"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-3 top-1/2 -translate-y-1/2 size-4 text-muted-foreground"}),e.jsx("input",{value:n.email,onChange:s=>i(a=>({...a,email:s.target.value})),type:"email",placeholder:"email@example.com",className:"w-full h-10 pl-10 pr-4 rounded-lg border border-input bg-background outline-none focus:ring-2 focus:ring-ring text-sm"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Mỗi email chỉ tạo được 1 tài khoản"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Họ và tên *"}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-3 top-1/2 -translate-y-1/2 size-4 text-muted-foreground"}),e.jsx("input",{value:n.full_name,onChange:s=>i(a=>({...a,full_name:s.target.value})),placeholder:"Nguyễn Văn A",className:"w-full h-10 pl-10 pr-4 rounded-lg border border-input bg-background outline-none focus:ring-2 focus:ring-ring text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Mật khẩu *"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{className:"absolute left-3 top-1/2 -translate-y-1/2 size-4 text-muted-foreground"}),e.jsx("input",{value:n.password,onChange:s=>i(a=>({...a,password:s.target.value})),type:b?"text":"password",placeholder:"Tối thiểu 6 ký tự",className:"w-full h-10 pl-10 pr-10 rounded-lg border border-input bg-background outline-none focus:ring-2 focus:ring-ring text-sm"}),e.jsx("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",onClick:()=>q(!b),children:b?e.jsx(I,{className:"size-4"}):e.jsx(k,{className:"size-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Vai trò"}),e.jsx($,{value:n.role,onChange:s=>i(a=>({...a,role:s})),options:[{value:"user",label:"User"},{value:"admin",label:"Admin"}]})]})]}),e.jsxs("div",{className:"mt-5 flex gap-3",children:[e.jsx(r,{onClick:H,loading:z.isPending,className:"flex-1",children:"Tạo người dùng"}),e.jsx(r,{variant:"outline",onClick:()=>u(!1),className:"flex-1",children:"Hủy"})]})]}),e.jsx(K,{isOpen:Q,onClose:()=>j(!1),title:"Thông tin người dùng",size:"lg",children:t&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(p,{icon:A,label:"Họ và tên",value:t.full_name}),e.jsx(p,{icon:P,label:"Email",value:t.email}),e.jsx(p,{icon:X,label:"Vai trò",value:t.role==="admin"?"Quản trị viên":"Người dùng",badge:t.role==="admin"?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"}),e.jsx(p,{icon:J,label:"Ngày tạo",value:t.created_at?o(t.created_at):"—"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:O("size-2.5 rounded-full",t.is_active?"bg-green-500":"bg-red-500")}),e.jsx("span",{className:"text-sm font-medium",children:t.is_active?"Đang hoạt động":"Đã bị khóa"})]}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>{y.mutate(t.id),N(s=>s&&{...s,is_active:!s.is_active})},children:t.is_active?"Khóa tài khoản":"Kích hoạt"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium mb-2 flex items-center gap-1.5",children:[e.jsx(w,{className:"size-4"})," Tài khoản & mật khẩu"]}),e.jsxs("div",{className:"bg-muted/30 rounded-lg p-3 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Email đăng nhập"}),e.jsx("span",{className:"font-medium",children:t.email})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Mật khẩu"}),e.jsx("span",{className:"font-mono text-muted-foreground",children:"••••••••"})]}),t.updated_at&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Cập nhật lần cuối"}),e.jsx("span",{children:o(t.updated_at)})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium mb-2 flex items-center gap-1.5",children:[e.jsx(W,{className:"size-4"})," Lịch sử đổi mật khẩu"]}),t.password_history&&t.password_history.length>0?e.jsx("div",{className:"space-y-2",children:t.password_history.slice().sort((s,a)=>new Date(a.changed_at).getTime()-new Date(s.changed_at).getTime()).map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-2.5 bg-muted/30 rounded-lg text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"size-3.5 text-muted-foreground"}),e.jsx("span",{children:Y[s.reason]||s.reason})]}),e.jsx("span",{className:"text-muted-foreground text-xs",children:o(s.changed_at)})]},a))}):e.jsx("p",{className:"text-sm text-muted-foreground p-3 bg-muted/30 rounded-lg",children:"Chưa có lịch sử thay đổi mật khẩu"})]}),(t.phone_number||t.address||t.gender)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Thông tin bổ sung"}),e.jsxs("div",{className:"bg-muted/30 rounded-lg p-3 space-y-2 text-sm",children:[t.phone_number&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Số điện thoại"}),e.jsx("span",{children:t.phone_number})]}),t.gender&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Giới tính"}),e.jsx("span",{children:t.gender==="male"?"Nam":t.gender==="female"?"Nữ":"Khác"})]}),t.address&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Địa chỉ"}),e.jsx("span",{children:t.address})]}),t.date_of_birth&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Ngày sinh"}),e.jsx("span",{children:o(t.date_of_birth)})]})]})]})]})})]})}function p({icon:d,label:f,value:c,badge:x}){return e.jsxs("div",{className:"flex items-start gap-2.5",children:[e.jsx(d,{className:"size-4 text-muted-foreground mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:f}),x?e.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full mt-0.5 inline-block ${x}`,children:c}):e.jsx("p",{className:"text-sm font-medium",children:c})]})]})}export{le as default};
