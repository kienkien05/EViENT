import{j as n}from"./query-By2FkZ5k.js";import{r as m,u as k,h as S}from"./vendor-Bxm2pvdK.js";import{l as D,B as h,i as p,u as x,h as f}from"./index-CUfHF9RD.js";import{b as O,c as P,m as T}from"./ui-BgMx_JBB.js";function K(){const[i,u]=m.useState(["","","","","",""]),[y,g]=m.useState(!1),c=m.useRef([]),l=k(),{theme:j,toggleTheme:b}=D(),a=S().state;m.useEffect(()=>{var e;a!=null&&a.email?(e=c.current[0])==null||e.focus():l("/login",{replace:!0})},[a,l]);const N=(e,s)=>{var o;if(!/^\d*$/.test(s))return;const t=[...i];t[e]=s.slice(-1),u(t),s&&e<5&&((o=c.current[e+1])==null||o.focus()),t.every(r=>r!=="")&&s&&d(t.join(""))},v=(e,s)=>{var t;s.key==="Backspace"&&!i[e]&&e>0&&((t=c.current[e-1])==null||t.focus())},w=e=>{e.preventDefault();const s=e.clipboardData.getData("text").replace(/\D/g,"").slice(0,6),t=[...i];s.split("").forEach((o,r)=>{r<6&&(t[r]=o)}),u(t),s.length===6&&d(s)},d=async e=>{var s,t,o;if(a){g(!0);try{if(a.type==="forgot-password"||a.type==="change-password"){l("/reset-password",{state:{email:a.email,otp:e,type:a.type}});return}if(a.type==="register"){const{data:r}=await p.verifyRegister({email:a.email,otp:e,password:a.password,full_name:a.full_name});x.getState().login({token:r.data.token,user:r.data.user}),f.success("ÄÄƒng kÃ½ thÃ nh cÃ´ng!"),l("/")}else{const{data:r}=await p.verifyLogin({email:a.email,otp:e});x.getState().login({token:r.data.token,user:r.data.user}),f.success("ÄÄƒng nháº­p thÃ nh cÃ´ng!"),l(r.data.user.role==="admin"?"/admin":"/")}}catch(r){f.error(((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"MÃ£ OTP khÃ´ng Ä‘Ãºng"),u(["","","","","",""]),(o=c.current[0])==null||o.focus()}finally{g(!1)}}};return n.jsxs("div",{className:"min-h-screen relative flex items-center justify-center px-4 bg-gradient-to-br from-primary/5 via-background to-orange-500/5",children:[n.jsx("div",{className:"absolute top-4 right-4 sm:top-6 sm:right-6",children:n.jsx(h,{variant:"ghost",size:"icon",onClick:b,className:"rounded-full hover:bg-muted/50",children:j==="dark"?n.jsx(O,{className:"size-5"}):n.jsx(P,{className:"size-5"})})}),n.jsxs(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md",children:[n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("span",{className:"text-5xl",children:"ðŸ”"}),n.jsx("h1",{className:"mt-3 text-2xl font-bold",children:"XÃ¡c thá»±c OTP"}),n.jsxs("p",{className:"mt-2 text-muted-foreground text-sm",children:["Nháº­p mÃ£ 6 sá»‘ Ä‘Ã£ gá»­i Ä‘áº¿n ",n.jsx("span",{className:"font-medium text-foreground",children:a==null?void 0:a.email})]})]}),n.jsxs("div",{className:"bg-card border border-border rounded-2xl p-6 shadow-lg",children:[n.jsx("div",{className:"flex justify-center gap-2 sm:gap-3",onPaste:w,children:i.map((e,s)=>n.jsx("input",{ref:t=>{c.current[s]=t},type:"text",inputMode:"numeric",maxLength:1,value:e,onChange:t=>N(s,t.target.value),onKeyDown:t=>v(s,t),className:"w-11 h-14 sm:w-12 sm:h-16 text-center text-2xl font-bold rounded-xl border border-input bg-background focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all"},s))}),n.jsx(h,{onClick:()=>d(i.join("")),loading:y,disabled:i.some(e=>e===""),className:"w-full mt-6",size:"lg",children:"XÃ¡c nháº­n"}),n.jsxs("p",{className:"mt-4 text-center text-sm text-muted-foreground",children:["KhÃ´ng nháº­n Ä‘Æ°á»£c mÃ£?"," ",n.jsx("button",{className:"text-primary hover:underline font-medium",children:"Gá»­i láº¡i"})]})]})]})]})}export{K as default};
